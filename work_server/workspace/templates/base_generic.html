<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link href=" https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css " rel="stylesheet" />
    <!-- Add additional CSS in static file -->
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}" />
  </head>
  <body>
    {% block content %} {% endblock %}
    <div id="notification_block">{% include 'partials/notification.html' %}</div>
  </body>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const toggleButton = document.getElementById("nav-toggle");
      const navMenu = document.getElementById("nav-menu");

      toggleButton.addEventListener("click", function () {
        navMenu.classList.toggle("active");
        toggleButton.classList.toggle("active");
      });

      const navLinks = document.querySelectorAll(".nav-link");
      navLinks.forEach((link) => {
        link.addEventListener("click", function () {
          navMenu.classList.remove("active");
          toggleButton.classList.remove("active");
        });
      });

      document.addEventListener("click", function (event) {
        const isClickInsideNav = event.target.closest(".header-content");
        if (!isClickInsideNav && navMenu.classList.contains("active")) {
          navMenu.classList.remove("active");
          toggleButton.classList.remove("active");
        }
      });
    });
    $(document).ready(function () {
      function updateProducts() {
        $.ajax({
          url: window.location.pathname,
          headers: {
            "X-Requested-With": "XMLNotificationUpdate",
          },
          success: function (data) {
            if (data.html != "") {
              $("#notification_block").html(data.html);
              if (!("Notification" in window)) {
                // Check if the browser supports notifications
              } else if (Notification.permission === "granted") {
                // Check whether notification permissions have already been granted;
                // if so, create a notification
                const notification = new Notification(data.message, {
                  renotify: true,
                  timestamp: data.time,
                });
              } else if (Notification.permission !== "denied") {
                // We need to ask the user for permission
                Notification.requestPermission().then((permission) => {
                  // If the user accepts, let's create a notification
                  if (permission === "granted") {
                    const notification = new Notification(data.message, {
                      renotify: true,
                      timestamp: data.time,
                    });
                  }
                });
              }
            }
          },
        });
      }
      // Устанавливаем интервал обновления каждые 5 секунд
      setInterval(updateProducts, 5000);
    });
  </script>
</html>
